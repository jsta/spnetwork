<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • spnetwork</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">spnetwork</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/spn.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/edzer/spnetworks">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{An introduction to the spnetwork package}
\usepackage[utf8]{inputenc}
-->
<div id="an-introduction-to-the-spnetwork-package" class="section level1">
<h1 class="hasAnchor">
<a href="#an-introduction-to-the-spnetwork-package" class="anchor"></a>An introduction to the <code>spnetwork</code> package</h1>
<p>The <code>spnetwork</code> R package provides a class and several methods for handling spatial networks, where the edges (links) in the network are represented by spatial lines and the nodes (vertices) by spatial points. The spatial information (lines, points) is represented by the <code>sp</code> package, the graph information (edges, vertices, direction) is taken care of by the <code>igraph</code> package. Spatial networks can represent for instance road networks, or river networks.</p>
<p>The <code>spnetwork</code> allows the creation of spatial networks, plotting, summarizing, subsetting, and conversion to lines, points, or graph data structures. Also, weights of network edges (e.g. the length of an edge, or the time it takes to pass it) can be set, retrieved, and modified.</p>
<p>We will start with a little example that creates a toy network from scratch. It looks a bit awkward; in practice we will read edge data from external files, such as shapefiles. The following example creates a <code>SpatialLines</code> object, with a single <code>Line</code> per feature:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l0 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))
l1 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>))
l2 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))
l3 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>))
l4 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>))
l5 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))
l6 =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))
<span class="kw">library</span>(sp)
L1 =<span class="st"> </span><span class="cf">function</span>(l) <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/Line">Lines</a></span>(<span class="kw">list</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/Line">Line</a></span>(l)), <span class="kw">as.character</span>(<span class="kw">substitute</span>(l)))
sl =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialLines">SpatialLines</a></span>(<span class="kw">list</span>(<span class="kw">L1</span>(l0), <span class="kw">L1</span>(l1), <span class="kw">L1</span>(l2), <span class="kw">L1</span>(l3), <span class="kw">L1</span>(l4), <span class="kw">L1</span>(l5), <span class="kw">L1</span>(l6)))</code></pre></div>
<p>The class <code>SpatialNetwork</code>, which looks like</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spnetwork)
<span class="kw">showClass</span>(<span class="st">"SpatialNetwork"</span>)</code></pre></div>
<pre><code>## Class "SpatialNetwork" [package "spnetwork"]
## 
## Slots:
##                                                                   
## Name:            g weightfield        data       lines        bbox
## Class:      igraph   character  data.frame        list      matrix
##                   
## Name:  proj4string
## Class:         CRS
## 
## Extends: 
## Class "SpatialLinesDataFrame", directly
## Class "SpatialLines", by class "SpatialLinesDataFrame", distance 2
## Class "Spatial", by class "SpatialLinesDataFrame", distance 3</code></pre>
<p>derives directly from <code>SpatialLinesDataFrame</code>, and contains a slot <code>g</code> of class <code>igraph</code>, and a slot <code>weightfield</code> that tracks which information is used to specify weights. The remaining slots, <code>lines</code>, <code>data</code>, <code>bbox</code> and <code>proj4string</code> are derived from <code>SpatialLinesDataFrame</code>.</p>
<p>The function <code>SpatialNetwork</code> creates a spatial network from lines only:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sln =<span class="st"> </span><span class="kw"><a href="../reference/SpatialNetwork-class.html">SpatialNetwork</a></span>(sl)
<span class="kw"><a href="../reference/SpatialNetwork-methods.html">summary</a></span>(sln)</code></pre></div>
<pre><code>## Object of class SpatialNetwork
## Coordinates:
##   min max
## x   0   3
## y   0   4
## Is projected: NA 
## proj4string : [NA]
## # edges: 7 # nodes/vertices: 7 
## # weightfield: length 
## Graph summary:
## IGRAPH U-W- 7 7 -- 
## + attr: x (v/n), y (v/n), n (v/n), link_index (e/n), weight (e/n)
## Lines attributes:
##        id          length          start            end       
##  Min.   :1.0   Min.   :1.000   Min.   :1.000   Min.   :2.000  
##  1st Qu.:2.5   1st Qu.:1.707   1st Qu.:2.500   1st Qu.:4.500  
##  Median :4.0   Median :2.000   Median :4.000   Median :6.000  
##  Mean   :4.0   Mean   :2.035   Mean   :3.571   Mean   :5.143  
##  3rd Qu.:5.5   3rd Qu.:2.414   3rd Qu.:4.500   3rd Qu.:6.000  
##  Max.   :7.0   Max.   :3.000   Max.   :6.000   Max.   :7.000</code></pre>
<p>When given a set of lines only, as done here, it needs to sort out which lines are connected by comparing all first and last points of each line, and forms connections (shared nodes/vertices) when they coincide.</p>
<p>Optionally, <code>SpatialNetwork</code> can be given an igraph object (in which case it will not sort out the graph from the lines), information to override the default weights (line lengths), and (as explained below) also directions.</p>
<p>We can take out the graph constructed by <code>sln@g</code>, and plot several of its properties:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)</code></pre></div>
<pre><code>## 
## Attaching package: 'igraph'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g =<span class="st"> </span>sln<span class="op">@</span>g
<span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(g)<span class="op">$</span>x, <span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(g)<span class="op">$</span>y, <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(g)<span class="op">$</span>n, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="dv">2</span>, <span class="dt">asp =</span> <span class="dv">1</span>)
<span class="kw">lines</span>(sl)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(g)<span class="op">$</span>x, <span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(g)<span class="op">$</span>y, <span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(g))), <span class="dt">pos =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-4-1.png" width="672"> where node color indicates the number of edges it is shared by.</p>
<p>Here, <code>V(g)$x</code> is the <code>x</code> attribute of the graph vertices (<code>V</code>); similarly,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/E">E</a></span>(g)<span class="op">$</span>weight</code></pre></div>
<pre><code>## [1] 1.000000 2.000000 2.000000 2.414214 2.414214 3.000000 1.414214</code></pre>
<p>retrieves graph edge attributes.</p>
<p>We can let <code>igraph</code> plot this graph, as in</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(g)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>and see that x and y attributes are used for the layout, but axes are rescaled and edges are replaced by straight lines.</p>
</div>
<div id="directed-graphs" class="section level1">
<h1 class="hasAnchor">
<a href="#directed-graphs" class="anchor"></a>Directed graphs</h1>
<p>In the example above, we can create a directed network by specifying the link directions, with 0 indicating two-way, 1 indicating one-way down-link (i.e. in the direction of the sequence of coordinates of a line), and -1 indicating one-way up-link:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sln =<span class="st"> </span><span class="kw"><a href="../reference/SpatialNetwork-class.html">SpatialNetwork</a></span>(sl, <span class="dt">direction =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))
<span class="kw"><a href="../reference/SpatialNetwork-methods.html">summary</a></span>(sln)</code></pre></div>
<pre><code>## Object of class SpatialNetwork
## Coordinates:
##   min max
## x   0   3
## y   0   4
## Is projected: NA 
## proj4string : [NA]
## # edges: 7 # nodes/vertices: 7 
## # weightfield: length 
## Graph summary:
## IGRAPH D-W- 7 9 -- 
## + attr: x (v/n), y (v/n), n (v/n), downlink (e/l), link_index
## | (e/n), weight (e/n)
## Lines attributes:
##        id        direction           length          start      
##  Min.   :1.0   Min.   :-1.0000   Min.   :1.000   Min.   :1.000  
##  1st Qu.:2.5   1st Qu.:-1.0000   1st Qu.:1.707   1st Qu.:2.500  
##  Median :4.0   Median : 0.0000   Median :2.000   Median :4.000  
##  Mean   :4.0   Mean   :-0.1429   Mean   :2.035   Mean   :3.571  
##  3rd Qu.:5.5   3rd Qu.: 0.5000   3rd Qu.:2.414   3rd Qu.:4.500  
##  Max.   :7.0   Max.   : 1.0000   Max.   :3.000   Max.   :6.000  
##       end       
##  Min.   :2.000  
##  1st Qu.:4.500  
##  Median :6.000  
##  Mean   :5.143  
##  3rd Qu.:6.000  
##  Max.   :7.000</code></pre>
<p>we now see that the number of graph edges (9) exceeds the number of line segments (7), by a number equal to the number of two-way streets (2). Each graph edge has an index indicating which lines (links) correspond to it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g =<span class="st"> </span>sln<span class="op">@</span>g
<span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/E">E</a></span>(g)<span class="op">$</span>link_index</code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7 1 2</code></pre>
<p>The <code>igraph</code> plot of this graph now indicates edges direction:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(g)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>and also the <code>spnetwork</code> plot method can add arrows to links that have only one direction:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(sln, <span class="dt">arrow_size =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="a-larger-example-shortest-path-network-subset" class="section level1">
<h1 class="hasAnchor">
<a href="#a-larger-example-shortest-path-network-subset" class="anchor"></a>A larger example: shortest path, network subset</h1>
<p>We’ll use Delauny triangulation from package deldir:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(deldir)</code></pre></div>
<pre><code>## deldir 0.1-14</code></pre>
<p>The following function converts a set of points into a SpatialPolygons or into a SpatialLines object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dd &lt;-<span class="st"> </span><span class="cf">function</span>(x, ..., <span class="dt">to =</span> <span class="st">"polygons"</span>) {
    <span class="kw">stopifnot</span>(<span class="kw">is</span>(x, <span class="st">"Spatial"</span>))
    cc =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(x)
    dd =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/deldir/topics/deldir">deldir</a></span>(<span class="kw">list</span>(<span class="dt">x =</span> cc[, <span class="dv">1</span>], <span class="dt">y =</span> cc[, <span class="dv">2</span>]), ...)
    <span class="cf">if</span> (to <span class="op">==</span><span class="st"> "polygons"</span>) {
        tm =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/deldir/topics/triMat">triMat</a></span>(dd)
        fn =<span class="st"> </span><span class="cf">function</span>(i) <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialPolygons">Polygons</a></span>(<span class="kw">list</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialPolygons">Polygon</a></span>(<span class="kw">rbind</span>(cc[tm[<span class="kw">c</span>(i, i[<span class="dv">1</span>]),], ]))), i)
        <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialPolygons">SpatialPolygons</a></span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(tm), fn), <span class="dt">proj4string =</span> x<span class="op">@</span>proj4string)
    } <span class="cf">else</span> <span class="cf">if</span> (to <span class="op">==</span><span class="st"> "lines"</span>) {
        segs =<span class="st"> </span>dd<span class="op">$</span>delsgs
        fn =<span class="st"> </span><span class="cf">function</span>(i) <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/Line">Lines</a></span>(<span class="kw">list</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/Line">Line</a></span>(cc[<span class="kw">c</span>(segs[i, <span class="dv">5</span>], segs[i, <span class="dv">6</span>]), ])), i)
        <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialLines">SpatialLines</a></span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(segs), fn), <span class="dt">proj4string =</span> x<span class="op">@</span>proj4string)
    } <span class="cf">else</span> <span class="kw">stop</span>(<span class="st">"argument to should be polygons or lines"</span>)
}</code></pre></div>
<p>We’ll generate a set of</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">300</span></code></pre></div>
<p>points in a unit square:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">5432</span>)
pts =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialPoints">SpatialPoints</a></span>(<span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">sort</span>(<span class="kw">runif</span>(n)), <span class="dt">y =</span> <span class="kw">runif</span>(n)))
sl =<span class="st"> </span><span class="kw">dd</span>(pts, <span class="dt">to =</span> <span class="st">"lines"</span>)</code></pre></div>
<pre><code>## 
##      PLEASE NOTE:  The components "delsgs" and "summary" of the
##  object returned by deldir() are now DATA FRAMES rather than
##  matrices (as they were prior to release 0.0-18).
##  See help("deldir").
##  
##      PLEASE NOTE: The process that deldir() uses for determining
##  duplicated points has changed from that used in version
##  0.0-9 of this package (and previously). See help("deldir").</code></pre>
<p>From this object, we can create a SpatialNetwork by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">net =<span class="st"> </span><span class="kw"><a href="../reference/SpatialNetwork-class.html">SpatialNetwork</a></span>(sl)</code></pre></div>
<p>when plotted, we can again use colour to denote the number of vertices connected to each edge:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(net)
<span class="kw">points</span>(net)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>Now we compute the shortest path from the left-most point (1) to the right-most one (100):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/distances">get.shortest.paths</a></span>(net<span class="op">@</span>g, <span class="dv">1</span>, n, <span class="dt">output =</span> <span class="st">"both"</span>)
sp =<span class="st"> </span><span class="kw">as.vector</span>(path<span class="op">$</span>vpath[[<span class="dv">1</span>]])
ids =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/as_ids">as_ids</a></span>(path<span class="op">$</span>epath[[<span class="dv">1</span>]])</code></pre></div>
<p>and plot it</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(net, <span class="dt">col =</span> <span class="st">'grey'</span>)
sel =<span class="st"> </span>net[ids,]
<span class="kw">lines</span>(sel, <span class="dt">col =</span> <span class="st">'red'</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">points</span>(sel)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(net<span class="op">@</span>g)<span class="op">$</span>x[<span class="kw">c</span>(<span class="dv">1</span>, n)], <span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/V">V</a></span>(net<span class="op">@</span>g)<span class="op">$</span>y[<span class="kw">c</span>(<span class="dv">1</span>, n)], <span class="kw">c</span>(<span class="st">"begin"</span>, <span class="st">"end"</span>), <span class="dt">pos =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>Note that <code><a href="../reference/SpatialNetwork-methods.html">net[ids,]</a></code> subsets the <code>SpatialNetwork</code> object, including the graph structure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SpatialNetwork-methods.html">summary</a></span>(sel)</code></pre></div>
<pre><code>## Object of class SpatialNetwork
## Coordinates:
##          min       max
## x 0.01410377 0.9961827
## y 0.04406870 0.9258722
## Is projected: NA 
## proj4string : [NA]
## # edges: 24 # nodes/vertices: 25 
## # weightfield: length 
## Graph summary:
## IGRAPH U-W- 25 24 -- 
## + attr: x (v/n), y (v/n), n (v/n), link_index (e/n), weight (e/n)
## Lines attributes:
##        id            length            start            end        
##  Min.   :  2.0   Min.   :0.01086   Min.   :  3.0   Min.   :  1.00  
##  1st Qu.:232.8   1st Qu.:0.03875   1st Qu.: 91.0   1st Qu.: 72.25  
##  Median :424.0   Median :0.04921   Median :152.0   Median :125.50  
##  Mean   :380.7   Mean   :0.05683   Mean   :137.9   Mean   :120.25  
##  3rd Qu.:529.2   3rd Qu.:0.07425   3rd Qu.:187.5   3rd Qu.:184.00  
##  Max.   :879.0   Max.   :0.13141   Max.   :300.0   Max.   :207.00</code></pre>
<p>As the edge weights are computed by Line lengths, this is the geographically shortest path from start to end.</p>
</div>
<div id="real-networks-toronto-ottawa" class="section level1">
<h1 class="hasAnchor">
<a href="#real-networks-toronto-ottawa" class="anchor"></a>Real networks: Toronto, Ottawa</h1>
<p>Package <code>spnetwork</code> comes with two toy data sets: <code>torontocentre</code> and <code>ottawacentre</code>. In the following plot, the Toronto city centre is plotted using green for two-way streets, and red for one-way streets, and arrows indicating one-way road direction.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"torontocentre"</span>)
tc =<span class="st"> </span><span class="kw"><a href="../reference/SpatialNetwork-class.html">SpatialNetwork</a></span>(torontocentre, <span class="dt">direction =</span> torontocentre<span class="op">$</span>DIRECTION_)
<span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(tc, <span class="dt">col =</span> <span class="kw">ifelse</span>(torontocentre<span class="op">$</span>DIRECTION_ <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">'green'</span>, <span class="st">'red'</span>), 
    <span class="dt">arrow_size =</span> .<span class="dv">3</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in arrows(pt[2, 1], pt[2, 2], pt[1, 1], pt[1, 2], length = 0.25 * :
## zero-length arrow is of indeterminate angle and so skipped</code></pre>
<p><img src="spn_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</div>
<div id="shortest-path-through-directed-graphs" class="section level1">
<h1 class="hasAnchor">
<a href="#shortest-path-through-directed-graphs" class="anchor"></a>Shortest path through directed graphs</h1>
<p>The following example first finds the shortest path between two arbitrary points (orange) and the corresponding nearest points formed by the graph nodes (blue). From these two blue points, shortest paths are found and plotted by nodes going north (blue circles) and going south (red triangles). Clearly, this leads to two different routes in a directed network.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"ottawacentre"</span>)
oc =<span class="st"> </span><span class="kw"><a href="../reference/SpatialNetwork-class.html">SpatialNetwork</a></span>(ottawacentre, <span class="dt">direction =</span> ottawacentre<span class="op">$</span>DIRECTION_)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(oc, <span class="dt">col =</span> <span class="kw">ifelse</span>(ottawacentre<span class="op">$</span>DIRECTION_ <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">'green'</span>, <span class="st">'red'</span>), <span class="dt">arrow_size=</span>.<span class="dv">3</span>)
<span class="kw"><a href="../reference/SpatialNetwork-methods.html">plot</a></span>(oc, <span class="dt">col =</span> <span class="kw">ifelse</span>(ottawacentre<span class="op">$</span>DIRECTION_ <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">'green'</span>, <span class="st">'red'</span>))
<span class="co"># find two distant points:</span>
m =<span class="st"> </span><span class="kw">rbind</span>(
<span class="kw">c</span>( <span class="op">-</span><span class="fl">75.70246</span>, <span class="fl">45.40728</span>),
<span class="kw">c</span>( <span class="op">-</span><span class="fl">75.69669</span>, <span class="fl">45.42286</span>)
)
pts =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/SpatialPoints">SpatialPoints</a></span>(m, <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/CRS-class">CRS</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(oc)))
<span class="kw">points</span>(pts, <span class="dt">col =</span> <span class="st">'orange'</span>, <span class="dt">pch =</span> <span class="dv">16</span>)
<span class="co"># find nearest nodes:</span>
oc.p =<span class="st"> </span><span class="kw">as</span>(oc, <span class="st">"SpatialPointsDataFrame"</span>)
nearest =<span class="st"> </span><span class="kw">apply</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spDistsN1">spDists</a></span>(pts, oc.p), <span class="dv">1</span>, which.min)
<span class="kw">points</span>(oc.p[nearest, ], <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">pch =</span> <span class="dv">16</span>)
path =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/distances">get.shortest.paths</a></span>(oc<span class="op">@</span>g, nearest[<span class="dv">1</span>], nearest[<span class="dv">2</span>], <span class="dt">output =</span> <span class="st">"both"</span>)
sp =<span class="st"> </span><span class="kw">as.vector</span>(path<span class="op">$</span>vpath[[<span class="dv">1</span>]])
ids =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/as_ids">as_ids</a></span>(path<span class="op">$</span>epath[[<span class="dv">1</span>]])
<span class="kw">points</span>(oc[,ids], <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">cex =</span> .<span class="dv">7</span>, <span class="dt">pch =</span> <span class="dv">16</span>)
path =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/distances">get.shortest.paths</a></span>(oc<span class="op">@</span>g, nearest[<span class="dv">2</span>], nearest[<span class="dv">1</span>], <span class="dt">output =</span> <span class="st">"both"</span>)
<span class="co"># sp = as.vector(path$vpath[[1]])</span>
ids =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/igraph/topics/as_ids">as_ids</a></span>(path<span class="op">$</span>epath[[<span class="dv">1</span>]])
<span class="kw">points</span>(oc[,ids], <span class="dt">col =</span> <span class="st">'red'</span>, <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="spn_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#an-introduction-to-the-spnetwork-package">An introduction to the <code>spnetwork</code> package</a></li>
      <li><a href="#directed-graphs">Directed graphs</a></li>
      <li><a href="#a-larger-example-shortest-path-network-subset">A larger example: shortest path, network subset</a></li>
      <li><a href="#real-networks-toronto-ottawa">Real networks: Toronto, Ottawa</a></li>
      <li><a href="#shortest-path-through-directed-graphs">Shortest path through directed graphs</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edzer Pebesma, Richard Ellison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
